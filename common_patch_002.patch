commit 10997e1bf668438dc8f64f3b6eef0604c8625303
Author: Eric <zrb@trigtop.com>
Date:   Sun Sep 29 15:19:47 2019 +0800

    fix 1000_eth

diff --git a/drivers/net/ethernet/stmicro/stmmac/dwmac-meson.c b/drivers/net/ethernet/stmicro/stmmac/dwmac-meson.c
index ed459b9..898bfbd 100644
--- a/drivers/net/ethernet/stmicro/stmmac/dwmac-meson.c
+++ b/drivers/net/ethernet/stmicro/stmmac/dwmac-meson.c
@@ -34,6 +34,7 @@
 /*if not g12a use genphy driver*/
 /* if it's internal phy we will shutdown analog*/
 static unsigned int is_internal_phy;
+static unsigned int external_invert_flag = 0;
 /* Ethernet register for G12A PHY */
 #define REG_ETH_REG1_OFFSET 0x4
 #define ETH_PLL_CTL0 0x44
@@ -68,7 +69,24 @@ struct meson_dwmac {
 static void meson6_dwmac_fix_mac_speed(void *priv, unsigned int speed)
 {
 #ifdef CONFIG_AMLOGIC_ETH_PRIVE
+	struct meson_dwmac *dwmac = priv;
+	unsigned int val;
+
+	if ((dwmac->data->g12a_phy) && (!is_internal_phy) && (external_invert_flag)) {
+		val = readl(dwmac->reg);
 
+		switch (speed) {
+		case SPEED_10:
+		case SPEED_100:
+			val &= ~(1<<3);
+			break;
+		case SPEED_1000:
+			val |= (1<<3);
+		break;
+		}
+
+		writel(val, dwmac->reg);
+	}
 #else
 	struct meson_dwmac *dwmac = priv;
 	unsigned int val;
@@ -312,7 +330,7 @@ static void __iomem *g12a_network_interface_setup(struct platform_device *pdev)
 	u32 internal_phy = 0;
 	int auto_cali_idx = -1;
 	is_internal_phy = 0;
-
+	external_invert_flag = 0;
 	pr_debug("g12a_network_interface_setup\n");
 	/*map PRG_ETH_REG */
 	res = platform_get_resource_byname(pdev, IORESOURCE_MEM, "eth_cfg");
@@ -401,6 +419,9 @@ static void __iomem *g12a_network_interface_setup(struct platform_device *pdev)
 		if (of_property_read_u32(np, "rx_delay", &external_rx_delay))
 			pr_debug("set exphy rx delay\n");
 		}
+
+		if (mc_val & (1<<3))
+	external_invert_flag = 1;
 		/* only exphy support wol since g12a*/
 		/*we enable/disable wol with item in dts with "wol=<1>"*/
 		if (of_property_read_u32(np, "wol",
